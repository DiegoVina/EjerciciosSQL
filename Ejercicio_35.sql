SELECT
	DIRECTOR_NAME,
	MAX(GENRE_NAME) AS FAVORITE_GENRE
FROM
	(
	SELECT
		d.DIRECTOR_NAME,
		g.GENRE_NAME,
		COUNT(*) AS GENRE_COUNT
	FROM
		DIRECTORS d
	JOIN 
        MOVIES m ON
		d.DIRECTOR_ID = m.DIRECTOR_ID
	JOIN 
        GENRES g ON
		m.GENRE_ID = g.GENRE_ID
	GROUP BY
		d.DIRECTOR_NAME,
		g.GENRE_NAME
	ORDER BY
		d.DIRECTOR_NAME,
		GENRE_COUNT DESC
    ) AS GENRE_COUNTS
GROUP BY
	DIRECTOR_NAME;








